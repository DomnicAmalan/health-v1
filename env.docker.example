# Docker Compose Environment Variables
# Copy this to .env and customize as needed

# ============================================
# Database Configuration
# ============================================
POSTGRES_USER=auth_user
POSTGRES_PASSWORD=auth_password
POSTGRES_DB=auth_db
POSTGRES_PORT=4111
# Database connection pool limits (for 512MB RAM systems)
DATABASE_MAX_CONNECTIONS=5
DATABASE_MIN_CONNECTIONS=1

# ============================================
# Service Ports (Lazarus Life Numbers from John 11)
# 4111 = 4 days + chapter 11
# 4115 = 4 days + 15 stadia
# 4117 = 4 days + verse 17
# ============================================
API_SERVICE_PORT=4117
ADMIN_UI_PORT=4111
CLIENT_APP_PORT=4115
NATS_PORT=4111
NATS_HTTP_PORT=4117
NATS_CLUSTER_PORT=4115
KAFKA_PORT=4117
KAFKA_INTERNAL_PORT=24117
KAFKA_CONTROLLER_PORT=24115
KAFKA_UI_PORT=4111

# ============================================
# RustyVault Configuration (Primary Secrets/Encryption Service)
# ============================================
# External access (from host machine)
VAULT_ADDR=http://localhost:4117
VAULT_TOKEN=dev-root-token
VAULT_PORT=4117
# Internal service configuration (inside Docker network)
VAULT_SERVER_HOST=0.0.0.0
VAULT_SERVER_PORT=4117
# Port mapping: external:internal (4117:4117)
VAULT_SERVICE_PORT=4117
VAULT_STORAGE_BACKEND=file
VAULT_STORAGE_PATH=/app/vault-data
VAULT_BARRIER_ALGORITHM=aes-gcm
VAULT_BARRIER_KEY_LENGTH=32
VAULT_SECRET_SHARES=5
VAULT_SECRET_THRESHOLD=3

# ============================================
# RustyVault UI Configuration
# ============================================
VAULT_UI_PORT=4115
# For Docker: use internal service name (rustyvault-service:4117)
# For local dev: use http://localhost:4117
VAULT_UI_API_BASE_URL=http://rustyvault-service:4117

# ============================================
# CORS Configuration (Both Backend and UI)
# ============================================
# RustyVault Service CORS - allowed origins (comma-separated)
# Note: Cannot use wildcard (*) with credentials=true
# Must specify exact origins when credentials are enabled
VAULT_CORS_ORIGINS=http://localhost:4115,http://localhost:3000,http://localhost:4111,http://localhost:4115

# API Service CORS - allowed origins (comma-separated)
CORS_ALLOWED_ORIGINS=http://localhost:4111,http://localhost:3000,http://localhost:4115,http://localhost:4115
CORS_ADMIN_UI_ORIGINS=http://localhost:4111
CORS_CLIENT_UI_ORIGINS=http://localhost:4115


# ============================================
# Auth Service Configuration
# ============================================
SERVER_HOST=0.0.0.0
SERVER_PORT=4117

# CORS Configuration (comma-separated list of allowed origins)
# Required when using credentials: 'include' (cookie-based auth)
CORS_ALLOWED_ORIGINS=http://localhost:4111,http://localhost:3000,http://localhost:4115

# Session Configuration
# App-specific session TTLs (in hours)
SESSION_ADMIN_UI_TTL_HOURS=8
SESSION_CLIENT_UI_TTL_HOURS=24
SESSION_API_TTL_HOURS=1
# Session cache size limit (for 512MB RAM systems)
SESSION_CACHE_MAX_ENTRIES=1000

# App-specific CORS origins (comma-separated)
CORS_ADMIN_UI_ORIGINS=http://localhost:4111
CORS_CLIENT_UI_ORIGINS=http://localhost:4115

# JWT Configuration (CHANGE IN PRODUCTION!)
JWT_SECRET=your-super-secret-jwt-key-change-in-production-min-32-chars

# OIDC Configuration
OIDC_ISSUER=http://localhost:4117
OIDC_CLIENT_ID=default-client
OIDC_CLIENT_SECRET=default-secret
JWT_EXPIRATION=3600

# KMS Configuration (using RustyVault)
KMS_PROVIDER=rustyvault
# Development master key (32 bytes hex-encoded) - DO NOT USE IN PRODUCTION
# Generate a new key: openssl rand -hex 32
MASTER_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef

# Storage Configuration
STORAGE_PROVIDER=local

# Logging
LOG_LEVEL=info
RUST_LOG=info

# Deployment
DEPLOYMENT_ENV=development
CLOUD_PROVIDER=none

# ============================================
# Memory Optimization Settings (512MB RAM)
# ============================================
# Graph cache configuration
GRAPH_CACHE_ENABLED=true
GRAPH_CACHE_TTL_SECONDS=60

# Tokio runtime configuration
TOKIO_WORKER_THREADS=2

# Rust build configuration (for low-memory systems)
CARGO_BUILD_JOBS=2

# ============================================
# Service Enable Flags
# ============================================
ENABLE_POSTGRES=true
ENABLE_RUSTYVAULT=true
ENABLE_RUSTYVAULT_SERVICE=true
ENABLE_NATS=false
ENABLE_KAFKA=false
ENABLE_SONARQUBE=false

# ============================================
# Admin UI Configuration
# ============================================
ADMIN_UI_API_BASE_URL=http://localhost:4117
VITE_OIDC_ISSUER=http://localhost:4117
VITE_OIDC_CLIENT_ID=default-client
VITE_ENABLE_POSTGRES=true
VITE_ENABLE_NATS=false
VITE_ENABLE_KAFKA=false

# ============================================
# Client App Configuration
# ============================================
CLIENT_APP_API_BASE_URL=http://localhost:4117

# ============================================
# Encrypted Storage Configuration
# ============================================
# Storage provider: local, encrypted_local, s3
STORAGE_PROVIDER=encrypted_local
LOCAL_STORAGE_PATH=./storage
STORAGE_ENCRYPTION_ENABLED=true

# Realm/Service DEK Isolation
ENABLE_REALM_DEK_ISOLATION=true
ENABLE_SERVICE_DEK_ISOLATION=true

# Zanzibar-Vault Integration
ENABLE_ZANZIBAR_VAULT_SYNC=true
ZANZIBAR_VAULT_SYNC_INTERVAL=60

# ============================================
# NATS Configuration
# ============================================
NATS_URL=nats://localhost:4111
NATS_ENABLE_JETSTREAM=true

# ============================================
# Kafka Configuration (KRaft mode)
# ============================================
KAFKA_BOOTSTRAP_SERVERS=localhost:4117
KAFKA_PORT=4117
KAFKA_INTERNAL_PORT=24117
KAFKA_CONTROLLER_PORT=24115
KAFKA_UI_PORT=4111
# KRaft mode configuration
KAFKA_PROCESS_ROLES=broker,controller
KAFKA_NODE_ID=1
KAFKA_CONTROLLER_QUORUM_VOTERS=1@kafka:29093

# ============================================
# SonarQube Configuration
# ============================================
SONARQUBE_PORT=9000
SONARQUBE_VERSION=community
SONARQUBE_DB=sonar
# SonarQube Database (Separate PostgreSQL instance)
SONARQUBE_DB_USER=sonar
SONARQUBE_DB_PASSWORD=sonar_password
SONARQUBE_DB_PORT=5444
# SonarQube Server
SONAR_HOST_URL=http://localhost:9000
SONAR_TOKEN=
SONAR_ORGANIZATION=
# SonarQube Java options (for 512MB RAM systems)
SONAR_CE_JAVAOPTS=-Xmx512m -Xms128m
SONAR_WEB_JAVAOPTS=-Xmx512m -Xms128m
SONAR_ES_BOOTSTRAP_CHECKS_DISABLE=true

